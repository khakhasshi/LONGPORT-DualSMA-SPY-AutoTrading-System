# SPY åŒå‡çº¿äº¤æ˜“ç­–ç•¥éœ€æ±‚è®¾è®¡æ–‡æ¡£

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®èƒŒæ™¯
åŸºäºæŠ€æœ¯åˆ†æä¸­ç»å…¸çš„åŒå‡çº¿äº¤å‰ç­–ç•¥ï¼Œé’ˆå¯¹SPYï¼ˆæ ‡æ™®500 ETFï¼‰è¿›è¡Œæ—¥çº¿çº§åˆ«çš„é‡åŒ–äº¤æ˜“ã€‚

### 1.2 é¡¹ç›®ç›®æ ‡
- å®ç°è‡ªåŠ¨åŒ–çš„SPYåŒå‡çº¿äº¤æ˜“ç­–ç•¥
- ä½¿ç”¨5æ—¥å‡çº¿ï¼ˆMA5ï¼‰å’Œ20æ—¥å‡çº¿ï¼ˆMA20ï¼‰ä½œä¸ºä¿¡å·è§¦å‘æ¡ä»¶
- é€šè¿‡ Longport Python SDK å®ç°å®ç›˜äº¤æ˜“

### 1.3 æŠ€æœ¯æ ˆ
- **ç¼–ç¨‹è¯­è¨€**: Python 3.9+
- **äº¤æ˜“SDK**: Longport Python SDK
- **æ•°æ®å¤„ç†**: pandas, numpy
- **è°ƒåº¦**: APScheduler æˆ–ç³»ç»Ÿ cron

---

## 2. ç­–ç•¥é€»è¾‘

### 2.1 æ ¸å¿ƒæŒ‡æ ‡
| æŒ‡æ ‡ | å‚æ•° | è¯´æ˜ |
|------|------|------|
| çŸ­æœŸå‡çº¿ | MA5 | 5æ—¥ç®€å•ç§»åŠ¨å¹³å‡çº¿ |
| é•¿æœŸå‡çº¿ | MA20 | 20æ—¥ç®€å•ç§»åŠ¨å¹³å‡çº¿ |

### 2.2 äº¤æ˜“ä¿¡å·

#### ä¹°å…¥ä¿¡å·ï¼ˆé‡‘å‰ï¼‰
- **æ¡ä»¶**: MA5 ä¸Šç©¿ MA20ï¼ˆå‰ä¸€æ—¥ MA5 < MA20ï¼Œå½“æ—¥ MA5 >= MA20ï¼‰
- **æ“ä½œ**: ä¹°å…¥ SPY
- **ä»“ä½**: å…¨ä»“æˆ–å›ºå®šæ¯”ä¾‹

#### å–å‡ºä¿¡å·ï¼ˆæ­»å‰ï¼‰
- **æ¡ä»¶**: MA5 ä¸‹ç©¿ MA20ï¼ˆå‰ä¸€æ—¥ MA5 > MA20ï¼Œå½“æ—¥ MA5 <= MA20ï¼‰
- **æ“ä½œ**: å–å‡ºæŒæœ‰çš„ SPY
- **ä»“ä½**: æ¸…ä»“æˆ–å›ºå®šæ¯”ä¾‹

### 2.3 ä¿¡å·ç¡®è®¤
- ä½¿ç”¨æ”¶ç›˜ä»·è®¡ç®—å‡çº¿
- ä¿¡å·åœ¨å½“æ—¥æ”¶ç›˜åç¡®è®¤ï¼Œæ¬¡æ—¥å¼€ç›˜æ‰§è¡Œ

---

## 3. è®¢å•æ‰§è¡Œæ–¹æ¡ˆè®¾è®¡

### 3.1 æ‰§è¡Œæ—¶åºé—®é¢˜åˆ†æ

**æ ¸å¿ƒé—®é¢˜ï¼š** ä¿¡å·åŸºäº T æ—¥æ”¶ç›˜ä»·è®¡ç®—ï¼Œä½†è®¢å•åœ¨ T+1 æ—¥æ‰§è¡Œï¼ŒæœŸé—´å¯èƒ½å‡ºç°ä»·æ ¼è·³ç©ºã€‚

```
æ—¶é—´çº¿ç¤ºæ„ï¼š
                T æ—¥                              T+1 æ—¥
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚        å¸¸è§„äº¤æ˜“æ—¶æ®µ          â”‚    â”‚        å¸¸è§„äº¤æ˜“æ—¶æ®µ          â”‚
    â”‚   9:30 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 16:00    â”‚    â”‚   9:30 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 16:00    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                         â”‚
                    â–¼                         â–¼
              æ”¶ç›˜ä»·ç¡®è®¤                  å¼€ç›˜ä»·å¯èƒ½è·³ç©º
              è®¡ç®—MAä¿¡å·                  æ‰§è¡Œä¹°å…¥/å–å‡º
                    â”‚                         â”‚
                    â””â”€â”€â”€â”€â”€â”€ éš”å¤œé£é™© â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç¾è‚¡äº¤æ˜“æ—¶æ®µï¼ˆç¾ä¸œæ—¶é—´ï¼‰ï¼š**
| æ—¶æ®µ | æ—¶é—´èŒƒå›´ | ç‰¹ç‚¹ |
|------|----------|------|
| ç›˜å‰äº¤æ˜“ | 04:00 - 09:30 | æµåŠ¨æ€§ä½ï¼Œä»·æ ¼æ³¢åŠ¨å¤§ |
| å¸¸è§„äº¤æ˜“ | 09:30 - 16:00 | æµåŠ¨æ€§æœ€ä½³ |
| ç›˜åäº¤æ˜“ | 16:00 - 20:00 | æµåŠ¨æ€§ä½ï¼Œå¯èƒ½æœ‰é‡å¤§æ–°é—»å½±å“ |

### 3.2 è®¢å•æ‰§è¡Œç­–ç•¥

#### æ–¹æ¡ˆä¸€ï¼šå¼€ç›˜å¸‚ä»·å•ï¼ˆæ¨èç”¨äºæµåŠ¨æ€§å¥½çš„ETFå¦‚SPYï¼‰

```
æ‰§è¡Œæµç¨‹ï¼š
1. T æ—¥ 16:00 åè·å–æ”¶ç›˜æ•°æ®
2. è®¡ç®— MA5/MA20ï¼Œåˆ¤æ–­æ˜¯å¦é‡‘å‰/æ­»å‰
3. è‹¥æœ‰ä¿¡å· â†’ è®°å½•å¾…æ‰§è¡Œè®¢å•
4. T+1 æ—¥ 09:30 å¼€ç›˜æ—¶æäº¤å¸‚ä»·å•
5. è®°å½•æˆäº¤ä»·æ ¼ï¼Œè®¡ç®—æ»‘ç‚¹
```

**ä¼˜ç‚¹ï¼š** å‡ ä¹100%æˆäº¤
**ç¼ºç‚¹ï¼š** å¯èƒ½æœ‰è¾ƒå¤§æ»‘ç‚¹ï¼ˆè·³ç©ºç¼ºå£ï¼‰
**é€‚ç”¨ï¼š** SPY è¿™ç±»é«˜æµåŠ¨æ€§æ ‡çš„

#### æ–¹æ¡ˆäºŒï¼šé™ä»·å• + è¿½å•æœºåˆ¶

```
æ‰§è¡Œæµç¨‹ï¼š
1. T æ—¥ 16:00 æ”¶ç›˜åç¡®è®¤ä¿¡å·
2. è®¡ç®—é™ä»·ï¼šæ”¶ç›˜ä»· Â± å®¹å¿æ»‘ç‚¹ï¼ˆå¦‚ 0.5%ï¼‰
   - ä¹°å…¥é™ä»· = æ”¶ç›˜ä»· Ã— (1 + 0.5%)
   - å–å‡ºé™ä»· = æ”¶ç›˜ä»· Ã— (1 - 0.5%)
3. T+1 æ—¥ 09:30 æäº¤é™ä»·å•
4. è‹¥ 10:00 å‰æœªæˆäº¤ â†’ æ’¤å•ï¼Œæ”¹å¸‚ä»·å•è¿½å•
5. è‹¥è¿½å•ä»æœªæˆäº¤ â†’ å–æ¶ˆæœ¬æ¬¡äº¤æ˜“ï¼Œç­‰å¾…ä¸‹ä¸€ä¿¡å·
```

**ä¼˜ç‚¹ï¼š** æ§åˆ¶æˆæœ¬ï¼Œé¿å…æç«¯æ»‘ç‚¹
**ç¼ºç‚¹ï¼š** å¯èƒ½é”™è¿‡äº¤æ˜“æœºä¼š
**é€‚ç”¨ï¼š** å¯¹æˆæœ¬æ•æ„Ÿçš„ç­–ç•¥

#### æ–¹æ¡ˆä¸‰ï¼šTWAP åˆ†æ‰¹æ‰§è¡Œï¼ˆå¤§èµ„é‡‘æ¨èï¼‰

```
æ‰§è¡Œæµç¨‹ï¼š
1. å°†è®¢å•æ‹†åˆ†ä¸º N ä»½ï¼ˆå¦‚ 5 ä»½ï¼‰
2. åœ¨ 09:30 - 10:30 æœŸé—´åˆ†æ‰¹æ‰§è¡Œ
3. æ¯æ‰¹ä½¿ç”¨é™ä»·å•ï¼Œé™ä»· = å½“å‰ä»·æ ¼ + å°‘é‡å®¹å¿åº¦
4. æœªæˆäº¤éƒ¨åˆ†åœ¨æœ€åæ”¹å¸‚ä»·å•
```

**ä¼˜ç‚¹ï¼š** é™ä½å¸‚åœºå†²å‡»ï¼Œå¹³æ»‘æˆæœ¬
**ç¼ºç‚¹ï¼š** å®ç°å¤æ‚ï¼Œæ‰§è¡Œæ—¶é—´é•¿
**é€‚ç”¨ï¼š** å¤§é¢è®¢å•

### 3.3 æ»‘ç‚¹æ§åˆ¶é…ç½®

```yaml
# config.yaml ä¸­çš„è®¢å•æ‰§è¡Œé…ç½®
order_execution:
  # æ‰§è¡Œç­–ç•¥: market | limit | twap
  strategy: "limit"
  
  # æ‰§è¡Œæ—¶æ®µ: open | intraday
  timing: "open"  # å¼€ç›˜æ‰§è¡Œ
  
  # é™ä»·å•é…ç½®
  limit_order:
    # ä¹°å…¥æ—¶å…è®¸çš„å‘ä¸Šæ»‘ç‚¹
    buy_slippage_pct: 0.5
    # å–å‡ºæ—¶å…è®¸çš„å‘ä¸‹æ»‘ç‚¹  
    sell_slippage_pct: 0.5
    # é™ä»·å•æœ‰æ•ˆæœŸï¼ˆåˆ†é’Ÿï¼‰ï¼Œè¶…æ—¶åæ”¹å¸‚ä»·å•
    timeout_minutes: 30
    # è¶…æ—¶åæ˜¯å¦è¿½å•
    chase_on_timeout: true
    
  # å¸‚ä»·å•é…ç½®
  market_order:
    # æœ€å¤§å¯æ¥å—æ»‘ç‚¹ï¼ˆè¶…è¿‡åˆ™å‘Šè­¦ï¼‰
    max_slippage_pct: 2.0
    
  # TWAP é…ç½®
  twap:
    # æ‹†åˆ†ä»½æ•°
    num_slices: 5
    # æ‰§è¡Œæ—¶é—´çª—å£ï¼ˆåˆ†é’Ÿï¼‰
    duration_minutes: 60
    
  # è·³ç©ºä¿æŠ¤
  gap_protection:
    enabled: true
    # è·³ç©ºè¶…è¿‡æ­¤æ¯”ä¾‹åˆ™æš‚åœæ‰§è¡Œ
    max_gap_pct: 3.0
    # æš‚åœåçš„å¤„ç†: wait | cancel | manual
    action_on_gap: "wait"
```

### 3.4 è®¢å•æ‰§è¡Œæµç¨‹å›¾

```
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚  Tæ—¥ 16:00å    â”‚
                          â”‚  è·å–æ”¶ç›˜æ•°æ®   â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚  è®¡ç®—MA5/MA20   â”‚
                          â”‚  åˆ¤æ–­äº¤å‰ä¿¡å·   â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚     æ˜¯å¦æœ‰ä¿¡å·ï¼Ÿ     â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚              â”‚
                          æ˜¯              å¦
                           â”‚              â”‚
                           â–¼              â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  è®°å½•å¾…æ‰§è¡Œè®¢å•  â”‚    â”‚  æ— æ“ä½œ     â”‚
              â”‚  å‘é€ä¿¡å·é€šçŸ¥    â”‚    â”‚  ç­‰å¾…æ˜æ—¥   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ T+1æ—¥ 09:30
                       â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  æ£€æŸ¥å¼€ç›˜ä»·     â”‚
              â”‚  è®¡ç®—è·³ç©ºå¹…åº¦   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   è·³ç©º > é˜ˆå€¼ï¼Ÿ     â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚              â”‚
              æ˜¯              å¦
               â”‚              â”‚
               â–¼              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  è§¦å‘è·³ç©ºä¿æŠ¤    â”‚  â”‚  æ­£å¸¸æ‰§è¡Œè®¢å•   â”‚
    â”‚  ç­‰å¾…/å–æ¶ˆ/äººå·¥  â”‚  â”‚  (å¸‚ä»·/é™ä»·)    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚   è®¢å•å·²æˆäº¤ï¼Ÿ   â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚          â”‚
                           æ˜¯          å¦
                            â”‚          â”‚
                            â–¼          â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚  è®°å½•æˆäº¤ä¿¡æ¯   â”‚  â”‚  è¶…æ—¶å¤„ç†       â”‚
               â”‚  è®¡ç®—å®é™…æ»‘ç‚¹   â”‚  â”‚  è¿½å•/å–æ¶ˆ      â”‚
               â”‚  å‘é€æˆäº¤é€šçŸ¥   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.5 è®¢å•çŠ¶æ€ç®¡ç†

```python
# è®¢å•çŠ¶æ€æšä¸¾
class OrderStatus(Enum):
    PENDING = "pending"           # å¾…æ‰§è¡Œï¼ˆä¿¡å·å·²ç¡®è®¤ï¼Œç­‰å¾…å¼€ç›˜ï¼‰
    SUBMITTED = "submitted"       # å·²æäº¤
    PARTIAL_FILLED = "partial"    # éƒ¨åˆ†æˆäº¤
    FILLED = "filled"             # å®Œå…¨æˆäº¤
    CANCELLED = "cancelled"       # å·²å–æ¶ˆ
    REJECTED = "rejected"         # è¢«æ‹’ç»
    EXPIRED = "expired"           # å·²è¿‡æœŸ
    GAP_PROTECTED = "gap_protected"  # è·³ç©ºä¿æŠ¤ä¸­

# è®¢å•æ‰§è¡Œè®°å½•
{
    "order_id": "ORD_20250130_001",
    "signal_date": "2025-01-29",          # ä¿¡å·äº§ç”Ÿæ—¥æœŸ
    "signal_price": 450.25,               # ä¿¡å·ç¡®è®¤æ—¶çš„æ”¶ç›˜ä»·
    "execution_date": "2025-01-30",       # æ‰§è¡Œæ—¥æœŸ
    "open_price": 452.10,                 # æ‰§è¡Œæ—¥å¼€ç›˜ä»·
    "gap_pct": 0.41,                      # è·³ç©ºç™¾åˆ†æ¯”
    "order_type": "limit",
    "limit_price": 452.50,                # é™ä»·
    "filled_price": 452.35,               # å®é™…æˆäº¤ä»·
    "slippage_pct": 0.47,                 # ç›¸å¯¹ä¿¡å·ä»·çš„æ»‘ç‚¹
    "status": "filled",
    "filled_at": "2025-01-30T09:31:25"
}
```

### 3.6 å¼‚å¸¸æƒ…å†µå¤„ç†

| åœºæ™¯ | å¤„ç†ç­–ç•¥ | è¯´æ˜ |
|------|----------|------|
| **å¤§å¹…è·³ç©ºé«˜å¼€** (>3%) | æš‚åœä¹°å…¥ï¼Œç­‰å¾…å›è½æˆ–å–æ¶ˆ | é¿å…è¿½é«˜ |
| **å¤§å¹…è·³ç©ºä½å¼€** (>3%) | æš‚åœå–å‡ºï¼Œè¯„ä¼°æ˜¯å¦æ­¢æŸ | é˜²æ­¢ææ…Œå–å‡º |
| **é™ä»·å•è¶…æ—¶æœªæˆäº¤** | æ”¹å¸‚ä»·å•æˆ–å–æ¶ˆ | å¯é…ç½® |
| **éƒ¨åˆ†æˆäº¤** | å‰©ä½™éƒ¨åˆ†æ”¹å¸‚ä»·å• | ç¡®ä¿ä»“ä½ä¸€è‡´æ€§ |
| **API è¿æ¥å¤±è´¥** | é‡è¯•3æ¬¡ï¼Œå¤±è´¥åˆ™å‘Šè­¦äººå·¥ä»‹å…¥ | - |
| **è´¦æˆ·ä½™é¢ä¸è¶³** | å–æ¶ˆè®¢å•ï¼Œå‘é€å‘Šè­¦ | - |
| **éäº¤æ˜“æ—¥** | è·³è¿‡æ‰§è¡Œï¼Œä¿¡å·é¡ºå»¶ | æ£€æŸ¥äº¤æ˜“æ—¥å† |

### 3.7 å»ºè®®çš„é»˜è®¤æ‰§è¡Œç­–ç•¥

é’ˆå¯¹ **SPY åŒå‡çº¿æ—¥çº¿ç­–ç•¥**ï¼Œæ¨èé…ç½®ï¼š

```yaml
order_execution:
  strategy: "limit"
  timing: "open"
  
  limit_order:
    buy_slippage_pct: 0.3      # SPYæµåŠ¨æ€§å¥½ï¼Œ0.3%è¶³å¤Ÿ
    sell_slippage_pct: 0.3
    timeout_minutes: 30        # 30åˆ†é’Ÿå†…æœªæˆäº¤åˆ™è¿½å•
    chase_on_timeout: true
    
  gap_protection:
    enabled: true
    max_gap_pct: 2.0           # è·³ç©ºè¶…è¿‡2%æš‚åœ
    action_on_gap: "wait"      # ç­‰å¾…ç›˜ä¸­ä»·æ ¼å›å½’
```

**ç†ç”±ï¼š**
1. SPY æ˜¯æœ€é«˜æµåŠ¨æ€§çš„ ETFï¼Œä¹°å–ä»·å·®æå°ï¼ˆé€šå¸¸ < 0.01%ï¼‰
2. æ—¥çº¿çº§åˆ«ç­–ç•¥å¯¹å‡ ä¸ªç‚¹çš„æ»‘ç‚¹ä¸æ•æ„Ÿ
3. åŒå‡çº¿æ˜¯è¶‹åŠ¿è·Ÿè¸ªç­–ç•¥ï¼Œé‡è¦çš„æ˜¯"ä¸Šè½¦"ï¼Œè€Œéç²¾ç¡®ä»·æ ¼
4. é™ä»·å• + è¿½å•æœºåˆ¶å¯ä»¥åœ¨æ§åˆ¶æˆæœ¬çš„åŒæ—¶ç¡®ä¿æˆäº¤

---

## 4. åŠŸèƒ½æ¨¡å—è®¾è®¡

### 4.1 æ•°æ®è·å–æ¨¡å— (`data_fetcher.py`)
```
åŠŸèƒ½ï¼š
- è·å–SPYå†å²Kçº¿æ•°æ®ï¼ˆæ—¥çº¿ï¼‰
- è·å–å®æ—¶è¡Œæƒ…æ•°æ®
- æ•°æ®æ¸…æ´—ä¸éªŒè¯

æ¥å£ï¼š
- get_historical_klines(symbol, period, count) -> DataFrame
- get_realtime_quote(symbol) -> dict
```

### 4.2 ç­–ç•¥è®¡ç®—æ¨¡å— (`strategy.py`)
```
åŠŸèƒ½ï¼š
- è®¡ç®—ç§»åŠ¨å¹³å‡çº¿
- ç”Ÿæˆäº¤æ˜“ä¿¡å·
- ä¿¡å·çŠ¶æ€ç®¡ç†

æ¥å£ï¼š
- calculate_ma(data, period) -> Series
- generate_signal(data, short_period, long_period) -> Signal
- check_cross(ma_short, ma_long) -> str  # 'golden_cross' | 'death_cross' | 'none'
```

### 4.3 äº¤æ˜“æ‰§è¡Œæ¨¡å— (`trader.py`)
```
åŠŸèƒ½ï¼š
- è¿æ¥Longportäº¤æ˜“æ¥å£
- ä¸‹å•/æ’¤å•
- æŸ¥è¯¢æŒä»“å’Œè´¦æˆ·ä¿¡æ¯

æ¥å£ï¼š
- connect() -> bool
- place_order(symbol, side, quantity, order_type) -> OrderId
- cancel_order(order_id) -> bool
- get_positions() -> List[Position]
- get_account_balance() -> Balance
```

### 4.4 é£é™©æ§åˆ¶æ¨¡å— (`risk_manager.py`)
```
åŠŸèƒ½ï¼š
- ä»“ä½ç®¡ç†
- æ­¢æŸæ­¢ç›ˆè®¾ç½®
- æœ€å¤§å›æ’¤æ§åˆ¶

é…ç½®å‚æ•°ï¼š
- max_position_ratio: æœ€å¤§æŒä»“æ¯”ä¾‹ (é»˜è®¤: 100%)
- stop_loss_pct: æ­¢æŸç™¾åˆ†æ¯” (å¯é€‰)
- take_profit_pct: æ­¢ç›ˆç™¾åˆ†æ¯” (å¯é€‰)
- max_drawdown_pct: æœ€å¤§å›æ’¤é™åˆ¶ (å¯é€‰)
```

### 4.5 æ—¥å¿—ä¸é€šçŸ¥æ¨¡å— (`notifier.py`)
```
åŠŸèƒ½ï¼š
- äº¤æ˜“æ—¥å¿—è®°å½•
- å¼‚å¸¸å‘Šè­¦
- äº¤æ˜“ä¿¡å·/æˆäº¤é€šçŸ¥ï¼ˆé‚®ä»¶/å¾®ä¿¡/Telegramï¼‰
```

---

## 5. æ•°æ®ç»“æ„è®¾è®¡

### 5.1 Kçº¿æ•°æ®ç»“æ„
```python
{
    "symbol": "SPY.US",
    "timestamp": datetime,
    "open": float,
    "high": float,
    "low": float,
    "close": float,
    "volume": int
}
```

### 5.2 äº¤æ˜“ä¿¡å·ç»“æ„
```python
{
    "signal_time": datetime,
    "signal_type": "BUY" | "SELL" | "HOLD",
    "ma5": float,
    "ma20": float,
    "close_price": float,
    "reason": str
}
```

### 5.3 è®¢å•ç»“æ„
```python
{
    "order_id": str,
    "symbol": "SPY.US",
    "side": "Buy" | "Sell",
    "quantity": int,
    "order_type": "Market" | "Limit",
    "price": float,  # é™ä»·å•ä»·æ ¼
    "status": str,
    "create_time": datetime
}
```

---

## 6. æ‰§è¡Œæµç¨‹

### 6.1 æ¯æ—¥æ‰§è¡Œæµç¨‹
```
1. [ç¾ä¸œæ—¶é—´ 16:00 å] è·å–å½“æ—¥æ”¶ç›˜æ•°æ®
2. è®¡ç®— MA5 å’Œ MA20
3. åˆ¤æ–­æ˜¯å¦äº§ç”Ÿäº¤å‰ä¿¡å·
4. è‹¥æœ‰ä¿¡å· â†’ è®°å½•ä¿¡å·ï¼Œå‡†å¤‡æ¬¡æ—¥äº¤æ˜“
5. [æ¬¡æ—¥å¼€ç›˜] æ‰§è¡Œäº¤æ˜“æŒ‡ä»¤
6. è®°å½•äº¤æ˜“ç»“æœï¼Œå‘é€é€šçŸ¥
```

### 6.2 ç¨‹åºå¯åŠ¨æµç¨‹
```
1. åŠ è½½é…ç½®æ–‡ä»¶
2. åˆå§‹åŒ– Longport SDK è¿æ¥
3. éªŒè¯è´¦æˆ·çŠ¶æ€å’Œæƒé™
4. åŠ è½½å†å²æ•°æ®å¹¶è®¡ç®—åˆå§‹çŠ¶æ€
5. å¯åŠ¨å®šæ—¶ä»»åŠ¡è°ƒåº¦å™¨
6. è¿›å…¥ä¸»å¾ªç¯
```

---

## 7. é…ç½®æ–‡ä»¶è®¾è®¡ (`config.yaml`)

```yaml
# äº¤æ˜“æ ‡çš„
symbol: "SPY.US"

# ç­–ç•¥å‚æ•°
strategy:
  short_ma_period: 5
  long_ma_period: 20
  
# äº¤æ˜“å‚æ•°
trading:
  order_type: "Market"  # Market | Limit
  position_ratio: 1.0   # ä»“ä½æ¯”ä¾‹
  
# é£æ§å‚æ•°
risk:
  stop_loss_pct: null   # æ­¢æŸç™¾åˆ†æ¯”ï¼Œnullè¡¨ç¤ºä¸å¯ç”¨
  take_profit_pct: null # æ­¢ç›ˆç™¾åˆ†æ¯”
  
# Longport APIé…ç½®
longport:
  app_key: "${LONGPORT_APP_KEY}"
  app_secret: "${LONGPORT_APP_SECRET}"
  access_token: "${LONGPORT_ACCESS_TOKEN}"
  
# é€šçŸ¥é…ç½®
notification:
  enabled: true
  channels:
    - type: "email"
      recipient: "your@email.com"
```

---

## 8. Longport SDK å…³é”®æ¥å£

### 8.1 è¡Œæƒ…æ¥å£ (QuoteContext)
```python
from longport.openapi import QuoteContext, Config

config = Config.from_env()
ctx = QuoteContext(config)

# è·å–Kçº¿æ•°æ®
candlesticks = ctx.candlesticks("SPY.US", Period.Day, 30)
```

### 8.2 äº¤æ˜“æ¥å£ (TradeContext)
```python
from longport.openapi import TradeContext, OrderSide, OrderType

trade_ctx = TradeContext(config)

# ä¸‹å•
order = trade_ctx.submit_order(
    symbol="SPY.US",
    order_type=OrderType.Market,
    side=OrderSide.Buy,
    submitted_quantity=100,
    time_in_force=TimeInForce.Day
)

# æŸ¥è¯¢æŒä»“
positions = trade_ctx.stock_positions()
```

---

## 9. CLI å‘½ä»¤è®¾è®¡

é¡¹ç›®é‡‡ç”¨ CLI æ–¹å¼è¿è¡Œï¼Œå‘½ä»¤è¡Œå·¥å…·åç§°ä¸º `realtrade`ï¼Œä½¿ç”¨ `click` åº“æ„å»ºã€‚

### 9.1 å‘½ä»¤æ€»è§ˆ

```bash
realtrade [OPTIONS] COMMAND [ARGS]...

å…¨å±€é€‰é¡¹:
  -c, --config PATH    æŒ‡å®šé…ç½®æ–‡ä»¶è·¯å¾„ (é»˜è®¤: ./config/config.yaml)
  -v, --verbose        å¯ç”¨è¯¦ç»†è¾“å‡ºæ¨¡å¼
  --debug              å¯ç”¨è°ƒè¯•æ¨¡å¼
  --version            æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯
  --help               æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
```

### 9.2 é…ç½®ç®¡ç†å‘½ä»¤ (`config`)

```bash
realtrade config [COMMAND]
```

| å­å‘½ä»¤ | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|
| `init` | åˆå§‹åŒ–é…ç½®æ–‡ä»¶ï¼ˆäº¤äº’å¼ï¼‰ | `realtrade config init` |
| `show` | æ˜¾ç¤ºå½“å‰é…ç½® | `realtrade config show` |
| `set` | è®¾ç½®é…ç½®é¡¹ | `realtrade config set strategy.short_ma_period 10` |
| `validate` | éªŒè¯é…ç½®æ–‡ä»¶æœ‰æ•ˆæ€§ | `realtrade config validate` |

```bash
# ç¤ºä¾‹
realtrade config init                              # äº¤äº’å¼åˆ›å»ºé…ç½®
realtrade config init --template                   # ä»æ¨¡æ¿åˆ›å»ºé…ç½®
realtrade config show                              # æ˜¾ç¤ºæ‰€æœ‰é…ç½®
realtrade config show --section strategy           # æ˜¾ç¤ºç­–ç•¥é…ç½®
realtrade config set trading.position_ratio 0.8   # è®¾ç½®ä»“ä½æ¯”ä¾‹ä¸º80%
realtrade config validate                          # éªŒè¯é…ç½®æ–‡ä»¶
```

### 9.3 è´¦æˆ·å‘½ä»¤ (`account`)

```bash
realtrade account [COMMAND]
```

| å­å‘½ä»¤ | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|
| `login` | éªŒè¯ Longport API è¿æ¥ | `realtrade account login` |
| `info` | æ˜¾ç¤ºè´¦æˆ·ä¿¡æ¯ | `realtrade account info` |
| `balance` | æŸ¥è¯¢è´¦æˆ·ä½™é¢ | `realtrade account balance` |
| `positions` | æŸ¥è¯¢å½“å‰æŒä»“ | `realtrade account positions` |

```bash
# ç¤ºä¾‹
realtrade account login                    # éªŒè¯APIè¿æ¥
realtrade account info                     # æ˜¾ç¤ºè´¦æˆ·åŸºæœ¬ä¿¡æ¯
realtrade account balance                  # æ˜¾ç¤ºç°é‡‘ä½™é¢
realtrade account balance --currency USD   # æ˜¾ç¤ºç¾å…ƒä½™é¢
realtrade account positions                # æ˜¾ç¤ºæ‰€æœ‰æŒä»“
realtrade account positions --symbol SPY   # æ˜¾ç¤ºSPYæŒä»“
```

### 9.4 è¡Œæƒ…æ•°æ®å‘½ä»¤ (`quote`)

```bash
realtrade quote [COMMAND]
```

| å­å‘½ä»¤ | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|
| `price` | è·å–å®æ—¶ä»·æ ¼ | `realtrade quote price SPY` |
| `kline` | è·å–Kçº¿æ•°æ® | `realtrade quote kline SPY --period day --count 30` |
| `export` | å¯¼å‡ºå†å²æ•°æ®åˆ°CSV | `realtrade quote export SPY -o data.csv` |

```bash
# ç¤ºä¾‹
realtrade quote price SPY                          # è·å–SPYå®æ—¶ä»·æ ¼
realtrade quote price SPY QQQ AAPL                 # è·å–å¤šä¸ªæ ‡çš„ä»·æ ¼
realtrade quote kline SPY                          # è·å–SPYæ—¥çº¿ï¼ˆé»˜è®¤30æ ¹ï¼‰
realtrade quote kline SPY --period day --count 60  # è·å–60æ ¹æ—¥çº¿
realtrade quote kline SPY --period week            # è·å–å‘¨çº¿
realtrade quote export SPY --start 2025-01-01 --end 2025-12-31 -o spy_2025.csv
```

### 9.5 ç­–ç•¥å‘½ä»¤ (`strategy`)

```bash
realtrade strategy [COMMAND]
```

| å­å‘½ä»¤ | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|
| `status` | æŸ¥çœ‹å½“å‰ç­–ç•¥çŠ¶æ€ | `realtrade strategy status` |
| `signal` | è®¡ç®—å¹¶æ˜¾ç¤ºå½“å‰ä¿¡å· | `realtrade strategy signal` |
| `history` | æŸ¥çœ‹å†å²ä¿¡å·è®°å½• | `realtrade strategy history` |
| `chart` | åœ¨ç»ˆç«¯æ˜¾ç¤ºå‡çº¿å›¾è¡¨ | `realtrade strategy chart` |

```bash
# ç¤ºä¾‹
realtrade strategy status                  # æ˜¾ç¤ºç­–ç•¥çŠ¶æ€ï¼ˆMAå€¼ã€æŒä»“çŠ¶æ€ç­‰ï¼‰
realtrade strategy signal                  # è®¡ç®—å½“å‰æ˜¯å¦æœ‰äº¤æ˜“ä¿¡å·
realtrade strategy signal --dry-run        # æ¨¡æ‹Ÿè®¡ç®—ï¼Œä¸æ‰§è¡Œäº¤æ˜“
realtrade strategy history                 # æ˜¾ç¤ºæœ€è¿‘çš„ä¿¡å·è®°å½•
realtrade strategy history --limit 20      # æ˜¾ç¤ºæœ€è¿‘20æ¡ä¿¡å·
realtrade strategy chart                   # ç»ˆç«¯æ˜¾ç¤ºä»·æ ¼å’Œå‡çº¿å›¾
realtrade strategy chart --days 60         # æ˜¾ç¤ºæœ€è¿‘60å¤©çš„å›¾è¡¨
```

### 9.6 äº¤æ˜“å‘½ä»¤ (`trade`)

```bash
realtrade trade [COMMAND]
```

| å­å‘½ä»¤ | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|
| `buy` | æ‰‹åŠ¨ä¹°å…¥ | `realtrade trade buy SPY --quantity 100` |
| `sell` | æ‰‹åŠ¨å–å‡º | `realtrade trade sell SPY --quantity 100` |
| `close` | å¹³ä»“æŒ‡å®šæ ‡çš„ | `realtrade trade close SPY` |
| `cancel` | æ’¤é”€è®¢å• | `realtrade trade cancel <order_id>` |
| `orders` | æŸ¥çœ‹è®¢å•åˆ—è¡¨ | `realtrade trade orders` |

```bash
# ç¤ºä¾‹
realtrade trade buy SPY --quantity 100                 # å¸‚ä»·ä¹°å…¥100è‚¡
realtrade trade buy SPY --quantity 100 --price 450.5   # é™ä»·ä¹°å…¥
realtrade trade buy SPY --amount 10000                 # æŒ‰é‡‘é¢ä¹°å…¥
realtrade trade sell SPY --quantity 50                 # å–å‡º50è‚¡
realtrade trade sell SPY --all                         # å…¨éƒ¨å–å‡º
realtrade trade close SPY                              # å¹³æ‰SPYæ‰€æœ‰ä»“ä½
realtrade trade cancel abc123                          # æ’¤é”€æŒ‡å®šè®¢å•
realtrade trade cancel --all                           # æ’¤é”€æ‰€æœ‰æŒ‚å•
realtrade trade orders                                 # æ˜¾ç¤ºä»Šæ—¥è®¢å•
realtrade trade orders --status pending                # æ˜¾ç¤ºæŒ‚å•
realtrade trade orders --days 7                        # æ˜¾ç¤ºæœ€è¿‘7å¤©è®¢å•
```

### 9.7 å›æµ‹å‘½ä»¤ (`backtest`)

```bash
realtrade backtest [OPTIONS]
```

| é€‰é¡¹ | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `--start` | å›æµ‹å¼€å§‹æ—¥æœŸ | 1å¹´å‰ |
| `--end` | å›æµ‹ç»“æŸæ—¥æœŸ | ä»Šå¤© |
| `--initial` | åˆå§‹èµ„é‡‘ | 100000 |
| `--short-ma` | çŸ­æœŸå‡çº¿å‘¨æœŸ | 5 |
| `--long-ma` | é•¿æœŸå‡çº¿å‘¨æœŸ | 20 |
| `--output` | è¾“å‡ºæŠ¥å‘Šè·¯å¾„ | - |
| `--plot` | ç”Ÿæˆå›¾è¡¨ | False |

```bash
# ç¤ºä¾‹
realtrade backtest                                     # ä½¿ç”¨é»˜è®¤å‚æ•°å›æµ‹
realtrade backtest --start 2024-01-01 --end 2025-01-01 # æŒ‡å®šæ—¶é—´èŒƒå›´
realtrade backtest --initial 50000                     # è®¾ç½®åˆå§‹èµ„é‡‘5ä¸‡
realtrade backtest --short-ma 10 --long-ma 30          # æµ‹è¯•ä¸åŒå‡çº¿å‚æ•°
realtrade backtest --plot                              # ç”Ÿæˆå›æµ‹å›¾è¡¨
realtrade backtest --output report.html                # å¯¼å‡ºHTMLæŠ¥å‘Š
realtrade backtest --optimize                          # å‚æ•°ä¼˜åŒ–æ¨¡å¼
```

**å›æµ‹è¾“å‡ºç¤ºä¾‹ï¼š**
```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
              ğŸ“Š å›æµ‹æŠ¥å‘Š - SPY åŒå‡çº¿ç­–ç•¥
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
å›æµ‹åŒºé—´: 2024-01-01 ~ 2025-01-01
åˆå§‹èµ„é‡‘: $100,000.00
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“ˆ æ”¶ç›ŠæŒ‡æ ‡
  æ€»æ”¶ç›Šç‡:      +18.52%
  å¹´åŒ–æ”¶ç›Šç‡:    +18.52%
  åŸºå‡†æ”¶ç›Šç‡:    +24.31% (ä¹°å…¥æŒæœ‰)
  è¶…é¢æ”¶ç›Š:      -5.79%
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“‰ é£é™©æŒ‡æ ‡  
  æœ€å¤§å›æ’¤:      -8.34%
  å¤æ™®æ¯”ç‡:      1.23
  ç´¢æè¯ºæ¯”ç‡:    1.67
  æ³¢åŠ¨ç‡:        15.2%
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“‹ äº¤æ˜“ç»Ÿè®¡
  æ€»äº¤æ˜“æ¬¡æ•°:    12
  èƒœç‡:          58.3%
  ç›ˆäºæ¯”:        1.85
  å¹³å‡æŒä»“å¤©æ•°:  28.5
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### 9.8 è¿è¡Œå‘½ä»¤ (`run`)

```bash
realtrade run [OPTIONS]
```

| é€‰é¡¹ | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `--mode` | è¿è¡Œæ¨¡å¼ (live/paper/signal) | signal |
| `--once` | åªæ‰§è¡Œä¸€æ¬¡ | False |
| `--daemon` | åå°å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼ | False |
| `--schedule` | æŒ‡å®šæ‰§è¡Œæ—¶é—´ (cronæ ¼å¼) | - |

```bash
# ç¤ºä¾‹
realtrade run                              # ä¿¡å·æ¨¡å¼ï¼Œåªè®¡ç®—ä¿¡å·ä¸äº¤æ˜“
realtrade run --mode signal                # åŒä¸Šï¼Œä¿¡å·ç›‘æ§æ¨¡å¼
realtrade run --mode paper                 # æ¨¡æ‹Ÿç›˜æ¨¡å¼
realtrade run --mode live                  # å®ç›˜æ¨¡å¼ âš ï¸
realtrade run --mode live --once           # å®ç›˜æ‰§è¡Œä¸€æ¬¡
realtrade run --daemon                     # åå°è¿è¡Œ
realtrade run --schedule "0 16 * * 1-5"   # ç¾ä¸œæ—¶é—´æ¯ä¸ªäº¤æ˜“æ—¥16:00æ‰§è¡Œ
```

**è¿è¡Œæ¨¡å¼è¯´æ˜ï¼š**

| æ¨¡å¼ | è¯´æ˜ | ç”¨é€” |
|------|------|------|
| `signal` | åªè®¡ç®—å’Œæ˜¾ç¤ºä¿¡å·ï¼Œä¸ä¸‹å• | æ—¥å¸¸ç›‘æ§ |
| `paper` | æ¨¡æ‹Ÿäº¤æ˜“ï¼Œè®°å½•è™šæ‹Ÿè®¢å• | ç­–ç•¥éªŒè¯ |
| `live` | å®ç›˜äº¤æ˜“ï¼ŒçœŸå®ä¸‹å• | æ­£å¼è¿è¡Œ |

### 9.9 æ—¥å¿—å‘½ä»¤ (`logs`)

```bash
realtrade logs [OPTIONS]
```

| é€‰é¡¹ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `--tail` | å®æ—¶æŸ¥çœ‹æ—¥å¿— | `realtrade logs --tail` |
| `--lines` | æ˜¾ç¤ºè¡Œæ•° | `realtrade logs --lines 100` |
| `--level` | è¿‡æ»¤æ—¥å¿—çº§åˆ« | `realtrade logs --level ERROR` |
| `--date` | æŒ‡å®šæ—¥æœŸ | `realtrade logs --date 2025-01-30` |

```bash
# ç¤ºä¾‹
realtrade logs                         # æ˜¾ç¤ºä»Šæ—¥æ—¥å¿—
realtrade logs --tail                  # å®æ—¶æŸ¥çœ‹æ—¥å¿—ï¼ˆç±»ä¼¼ tail -fï¼‰
realtrade logs --tail --level ERROR    # åªçœ‹é”™è¯¯æ—¥å¿—
realtrade logs --lines 200             # æ˜¾ç¤ºæœ€è¿‘200è¡Œ
realtrade logs --date 2025-01-29       # æŸ¥çœ‹æŒ‡å®šæ—¥æœŸæ—¥å¿—
realtrade logs --export week.log       # å¯¼å‡ºæœ¬å‘¨æ—¥å¿—
```

### 9.10 é€šçŸ¥å‘½ä»¤ (`notify`)

```bash
realtrade notify [COMMAND]
```

| å­å‘½ä»¤ | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|
| `test` | å‘é€æµ‹è¯•é€šçŸ¥ | `realtrade notify test` |
| `config` | é…ç½®é€šçŸ¥æ¸ é“ | `realtrade notify config` |
| `status` | æŸ¥çœ‹é€šçŸ¥é…ç½®çŠ¶æ€ | `realtrade notify status` |

```bash
# ç¤ºä¾‹
realtrade notify test                       # å‘é€æµ‹è¯•é€šçŸ¥åˆ°æ‰€æœ‰æ¸ é“
realtrade notify test --channel email       # åªæµ‹è¯•é‚®ä»¶é€šçŸ¥
realtrade notify config                     # äº¤äº’å¼é…ç½®é€šçŸ¥
realtrade notify status                     # æ˜¾ç¤ºé€šçŸ¥é…ç½®çŠ¶æ€
```

### 9.11 CLI å‘½ä»¤é€ŸæŸ¥è¡¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    realtrade CLI å‘½ä»¤é€ŸæŸ¥è¡¨                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é…ç½®ç®¡ç†                                                                 â”‚
â”‚   realtrade config init          åˆå§‹åŒ–é…ç½®æ–‡ä»¶                          â”‚
â”‚   realtrade config show          æ˜¾ç¤ºå½“å‰é…ç½®                            â”‚
â”‚   realtrade config validate      éªŒè¯é…ç½®æœ‰æ•ˆæ€§                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è´¦æˆ·æŸ¥è¯¢                                                                 â”‚
â”‚   realtrade account login        éªŒè¯APIè¿æ¥                             â”‚
â”‚   realtrade account balance      æŸ¥è¯¢è´¦æˆ·ä½™é¢                            â”‚
â”‚   realtrade account positions    æŸ¥è¯¢å½“å‰æŒä»“                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è¡Œæƒ…æ•°æ®                                                                 â”‚
â”‚   realtrade quote price SPY      è·å–å®æ—¶ä»·æ ¼                            â”‚
â”‚   realtrade quote kline SPY      è·å–Kçº¿æ•°æ®                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç­–ç•¥ç›¸å…³                                                                 â”‚
â”‚   realtrade strategy status      æŸ¥çœ‹ç­–ç•¥çŠ¶æ€                            â”‚
â”‚   realtrade strategy signal      è®¡ç®—å½“å‰ä¿¡å·                            â”‚
â”‚   realtrade strategy chart       æ˜¾ç¤ºå‡çº¿å›¾è¡¨                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ äº¤æ˜“æ“ä½œ                                                                 â”‚
â”‚   realtrade trade buy SPY        ä¹°å…¥                                    â”‚
â”‚   realtrade trade sell SPY       å–å‡º                                    â”‚
â”‚   realtrade trade orders         æŸ¥çœ‹è®¢å•                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å›æµ‹åˆ†æ                                                                 â”‚
â”‚   realtrade backtest             è¿è¡Œå›æµ‹                                â”‚
â”‚   realtrade backtest --plot      ç”Ÿæˆå›æµ‹å›¾è¡¨                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è¿è¡Œæ§åˆ¶                                                                 â”‚
â”‚   realtrade run                  ä¿¡å·ç›‘æ§æ¨¡å¼                            â”‚
â”‚   realtrade run --mode paper     æ¨¡æ‹Ÿç›˜æ¨¡å¼                              â”‚
â”‚   realtrade run --mode live      å®ç›˜æ¨¡å¼                                â”‚
â”‚   realtrade run --daemon         åå°è¿è¡Œ                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å…¶ä»–                                                                     â”‚
â”‚   realtrade logs --tail          å®æ—¶æŸ¥çœ‹æ—¥å¿—                            â”‚
â”‚   realtrade notify test          æµ‹è¯•é€šçŸ¥                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 10. é¡¹ç›®ç›®å½•ç»“æ„

```
realtrade/
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ config.yaml              # ä¸»é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ config.example.yaml      # é…ç½®æ¨¡æ¿
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ cli/                     # CLIæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ main.py              # CLIå…¥å£
â”‚   â”‚   â”œâ”€â”€ config_cmd.py        # config å‘½ä»¤ç»„
â”‚   â”‚   â”œâ”€â”€ account_cmd.py       # account å‘½ä»¤ç»„
â”‚   â”‚   â”œâ”€â”€ quote_cmd.py         # quote å‘½ä»¤ç»„
â”‚   â”‚   â”œâ”€â”€ strategy_cmd.py      # strategy å‘½ä»¤ç»„
â”‚   â”‚   â”œâ”€â”€ trade_cmd.py         # trade å‘½ä»¤ç»„
â”‚   â”‚   â”œâ”€â”€ backtest_cmd.py      # backtest å‘½ä»¤
â”‚   â”‚   â”œâ”€â”€ run_cmd.py           # run å‘½ä»¤
â”‚   â”‚   â”œâ”€â”€ logs_cmd.py          # logs å‘½ä»¤
â”‚   â”‚   â””â”€â”€ notify_cmd.py        # notify å‘½ä»¤ç»„
â”‚   â”œâ”€â”€ core/                    # æ ¸å¿ƒä¸šåŠ¡æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ data_fetcher.py      # æ•°æ®è·å–
â”‚   â”‚   â”œâ”€â”€ strategy.py          # ç­–ç•¥è®¡ç®—
â”‚   â”‚   â”œâ”€â”€ trader.py            # äº¤æ˜“æ‰§è¡Œ
â”‚   â”‚   â”œâ”€â”€ risk_manager.py      # é£é™©æ§åˆ¶
â”‚   â”‚   â””â”€â”€ notifier.py          # é€šçŸ¥æ¨¡å—
â”‚   â”œâ”€â”€ backtest/                # å›æµ‹æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ engine.py            # å›æµ‹å¼•æ“
â”‚   â”‚   â””â”€â”€ reporter.py          # æŠ¥å‘Šç”Ÿæˆ
â”‚   â””â”€â”€ utils/                   # å·¥å…·å‡½æ•°
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ config_loader.py     # é…ç½®åŠ è½½
â”‚       â”œâ”€â”€ logger.py            # æ—¥å¿—å·¥å…·
â”‚       â””â”€â”€ helpers.py           # è¾…åŠ©å‡½æ•°
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ test_strategy.py
â”‚   â”œâ”€â”€ test_trader.py
â”‚   â””â”€â”€ test_cli.py
â”œâ”€â”€ data/                        # æ•°æ®ç›®å½•
â”‚   â””â”€â”€ .gitkeep
â”œâ”€â”€ logs/                        # æ—¥å¿—ç›®å½•
â”‚   â””â”€â”€ .gitkeep
â”œâ”€â”€ pyproject.toml               # é¡¹ç›®é…ç½® (åŒ…å«CLIå…¥å£)
â”œâ”€â”€ requirements.txt             # ä¾èµ–åŒ…
â”œâ”€â”€ topic.md                     # éœ€æ±‚æ–‡æ¡£
â””â”€â”€ README.md                    # é¡¹ç›®è¯´æ˜
```

---

## 11. ä¾èµ–åŒ… (`requirements.txt`)

```
# äº¤æ˜“SDK
longport>=1.0.0

# CLIæ¡†æ¶
click>=8.1.0
rich>=13.0.0           # ç¾åŒ–ç»ˆç«¯è¾“å‡º

# æ•°æ®å¤„ç†
pandas>=1.5.0
numpy>=1.23.0
pyyaml>=6.0
apscheduler>=3.10.0
python-dotenv>=1.0.0

# ç»ˆç«¯ç»˜å›¾ (ç”¨äº strategy chart å‘½ä»¤)
plotext>=5.2.0
```

---

## 12. pyproject.toml é…ç½®

```toml
[project]
name = "realtrade"
version = "0.1.0"
description = "SPY åŒå‡çº¿äº¤æ˜“ç­–ç•¥ CLI å·¥å…·"
requires-python = ">=3.9"
dependencies = [
    "longport>=1.0.0",
    "click>=8.1.0",
    "rich>=13.0.0",
    "pandas>=1.5.0",
    "numpy>=1.23.0",
    "pyyaml>=6.0",
    "apscheduler>=3.10.0",
    "python-dotenv>=1.0.0",
    "plotext>=5.2.0",
]

[project.scripts]
realtrade = "src.cli.main:cli"

[project.optional-dependencies]
dev = [
    "pytest>=7.0.0",
    "pytest-cov>=4.0.0",
]

[build-system]
requires = ["setuptools>=61.0"]
build-backend = "setuptools.build_meta"
```

**å®‰è£…æ–¹å¼ï¼š**
```bash
# å¼€å‘æ¨¡å¼å®‰è£…
pip install -e .

# éªŒè¯å®‰è£…
realtrade --version
```

---

## 13. å¼€å‘è®¡åˆ’

| é˜¶æ®µ | ä»»åŠ¡ | é¢„è®¡æ—¶é—´ |
|------|------|----------|
| P1 | é¡¹ç›®åˆå§‹åŒ– & CLI æ¡†æ¶æ­å»º | 0.5å¤© |
| P2 | æ•°æ®è·å–æ¨¡å—å¼€å‘ | 1å¤© |
| P3 | ç­–ç•¥è®¡ç®—æ¨¡å—å¼€å‘ | 1å¤© |
| P4 | äº¤æ˜“æ‰§è¡Œæ¨¡å—å¼€å‘ | 1å¤© |
| P5 | å›æµ‹æ¨¡å—å¼€å‘ | 1å¤© |
| P6 | CLI å‘½ä»¤å®Œå–„ | 1å¤© |
| P7 | é›†æˆæµ‹è¯•ä¸æ¨¡æ‹Ÿäº¤æ˜“ | 2å¤© |
| P8 | å®ç›˜éƒ¨ç½²ä¸ç›‘æ§ | 1å¤© |

---

## 14. æ³¨æ„äº‹é¡¹

### 14.1 é£é™©æç¤º
- è¯¥ç­–ç•¥ä¸ºè¶‹åŠ¿è·Ÿè¸ªç­–ç•¥ï¼Œåœ¨éœ‡è¡å¸‚ä¸­å¯èƒ½äº§ç”Ÿé¢‘ç¹äº¤æ˜“å’ŒäºæŸ
- åŒå‡çº¿ç­–ç•¥å­˜åœ¨æ»åæ€§ï¼Œå¯èƒ½é”™è¿‡æœ€ä½³ä¹°å–ç‚¹
- å®ç›˜äº¤æ˜“å‰è¯·å……åˆ†å›æµ‹å¹¶ä½¿ç”¨æ¨¡æ‹Ÿç›˜éªŒè¯

### 14.2 åˆè§„è¦æ±‚
- ç¡®ä¿æ‹¥æœ‰ç¾è‚¡äº¤æ˜“èµ„è´¨
- éµå®ˆ Longport å¹³å°çš„ API è°ƒç”¨é™åˆ¶
- ä¿æŠ¤å¥½ API å¯†é’¥ç­‰æ•æ„Ÿä¿¡æ¯

### 14.3 è¿ç»´å»ºè®®
- éƒ¨ç½²åœ¨ç¨³å®šçš„æœåŠ¡å™¨ç¯å¢ƒï¼ˆæ¨èäº‘æœåŠ¡å™¨ï¼‰
- è®¾ç½®ç›‘æ§å‘Šè­¦ï¼Œç¡®ä¿ç¨‹åºæŒç»­è¿è¡Œ
- å®šæœŸæ£€æŸ¥æ—¥å¿—å’Œäº¤æ˜“è®°å½•